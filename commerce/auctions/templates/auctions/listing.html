{% extends 'auctions/layout.html' %}

{% block body %}
<div class="container shadow rounded bg-light mx-3 mt-4 p-4">
    {% if message2 %}
    <div class="alert alert-success" role="alert">
        {{ message2 }}
    </div>
    {% endif %}

    {% if user.is_authenticated %}
        <div class="d-flex flex-column gap-2 mb-3">
            {% if isOwner %}
                {% if listingItem.isActive %}
                <form class="glassmorph-form" action="{% url 'closeauction' listingItem.id %}" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger mt-2">Close Auction</button>
                </form>
                {% elif not listingItem.isActive %}
                <form class="glassmorph-form" action="{% url 'openauction' listingItem.id %}" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success mt-2">Open Auction</button>
                </form>
                {% endif %}
            {% endif %}

            {% if not isListingInWatchlist %}
            <form class="glassmorph-form" action="{% url 'addwatchers' listingItem.id %}" method="POST">
                {% csrf_token %}
                <button type="submit" class="btn btn-success mt-2">Add to Watchlist</button>
            </form>
            {% else %}
            <form class="glassmorph-form" action="{% url 'removewatchers' listingItem.id %}" method="POST">
                {% csrf_token %}
                <button type="submit" class="btn btn-warning mt-2">Remove from Watchlist</button>
            </form>
            {% endif %}
        </div>
    {% endif %}

    <div class="col-md-8 mx-auto p-4 rounded shadow bg-white" style="border-radius: var(--border-radius-lg); box-shadow: var(--shadow-lg);">
        <h2>{{ listingItem.title }}</h2>
        <img src="{{ listingItem.imageUrl }}" class="img-fluid rounded shadow-sm mb-3" alt="Listing Image">

        <h4 class="text-primary">Price: ${{ listingItem.price }}</h4>

        {% if listingItem.currentBid %}
        <h6 class="text-success">Current Highest bid: ${{ listingItem.currentBid }}</h6>
        {% endif %}

        {% if userBid %}
        <h6 class="text-info">Your bid: ${{ userBid }}</h6>
        {% endif %}

        {% if message %}
            {% if not update %}
            <div class="alert alert-danger" role="alert">
                Bid Amount Invalid
            </div>
            {% else %}
            <div class="alert alert-success" role="alert">
                Your Bid was placed successfully
            </div>
            {% endif %}
        {% endif %}

        {% if user.is_authenticated and listingItem.isActive %}
        <form class="mt-4" action="{% url 'addBid' listingItem.id %}" method="post">
            {% csrf_token %}
            <div class="row g-2 align-items-center">
                <div class="col-auto">
                    <label for="bidInput" class="col-form-label fw-bold">Place Bid:</label>
                </div>
                <div class="col-auto">
                    <input id="bidInput" type="number" class="form-control" name="offer" required>
                </div>
                <div class="col-auto">
                    <input type="submit" class="btn btn-primary" value="Submit">
                </div>
            </div>
        </form>
        {% endif %}

        <p class="h5 mt-4">Description: {{ listingItem.description }}</p>
        <hr>
        <h5>Listed by: <span class="text-secondary">{{ listingItem.owner }}</span></h5>
        <h5>Category: <span class="text-secondary">{{ listingItem.category }}</span></h5>
    </div>
</div>

<div class="container shadow rounded bg-light mx-3 mt-4 p-4">
    <div class="col-md-8 mx-auto">
        <h2>Comments</h2>
        {% if user.is_authenticated %}
        <form class="mt-3" action="{% url 'addcomment' listingItem.id %}" method='POST'>
            {% csrf_token %}
            <div class="mb-3">
                {{ commentform }}
            </div>
            <input type="submit" class="btn btn-primary mt-2" value="Comment">
        </form>
        {% endif %}
        <hr>
        {% for comment in comments %}
        <div class="mb-3 p-3 rounded bg-white shadow-sm" style="border-left: 4px solid var(--primary-color);">
            <p class="mb-1">{{ comment.comment }}</p>
            <p class="h6 text-muted">Commented by {{ comment.author }}</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}